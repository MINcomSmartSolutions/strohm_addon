<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Set default title for all portal pages -->
    <template id="custom_portal_layout_title" inherit_id="portal.portal_layout" name="Custom Portal Layout Title">
        <xpath expr="//t[@t-call='portal.frontend_layout']" position="inside">
            <t t-set="title" t-value="title or 'Portal - HM Laden'"/>
            <t t-set="x_icon">https://mediapool.hm.edu/media/_technik/img/_technik_1/favicon.jpg</t>
        </xpath>
    </template>
    <!-- Disable sale orders/quotations from portal home page using data record -->
    <record id="sale.portal_my_home_sale" model="ir.ui.view">
        <field name="active" eval="False"/>
    </record>

    <!-- Override portal_my_security template to remove password change section -->
    <template id="custom_sec" inherit_id="portal.portal_my_security" name="Custom Portal Security Fields" active='true'>
        <xpath expr="//t[@t-call='portal.portal_layout']" position="inside">
            <t t-set="title">HM Laden - Security</t>
        </xpath>
        <!-- Remove password change section -->
        <xpath expr="//section[@name='portal_change_password']" position="replace">
            <!-- This removes the password change section -->
        </xpath>

        <xpath expr="//section[@name='portal_revoke_all_devices_popup']" position="replace">
            <!-- This removes the revoke all devices popup no need for now-->
        </xpath>

        <!-- Modify account deactivation section -->
        <xpath expr="//section[@name='portal_deactivate_account']//form//hr" position="replace">
        <!-- Remove the horizontal line -->
        </xpath>

        <!-- Modify account deactivation section -->
        <xpath expr="//p[@class='text-muted']//b" position="inside">
            <br/>Sie dürfen Ihr Konto nicht löschen, wenn Sie offene Rechnungen oder laufende Ladesitzungen haben.
            Informationen zu den Richtlinien für die Datenlöschung finden Sie in den <a href="https://backend.laden.hm.edu/faq">FAQ</a>.
        </xpath>

        <!-- Add error message display for deactivate account -->
        <xpath expr="//section[@name='portal_deactivate_account']//form" position="inside">
            <div t-if="error_message" class="alert alert-danger mt-2" role="alert">
                <t t-esc="error_message"/>
            </div>
        </xpath>

        <!-- Override the account deactivation section to remove password verification -->
        <xpath expr="//section[@name='portal_deactivate_account']//form//p[2]" position="replace">
            <!-- Remove the password verification text -->
        </xpath>

        <xpath expr="//section[@name='portal_deactivate_account']//input[@name='password']" position="replace">
            <!-- Remove the password input field -->
        </xpath>
        <xpath expr="//section[@name='portal_deactivate_account']//label[@for='request_blacklist']" position="replace">
            <!-- Remove the blacklist request label -->
        </xpath>
        <xpath expr="//section[@name='portal_deactivate_account']//input[@name='request_blacklist']" position="replace">
            <!-- Remove the blacklist request checkbox -->
        </xpath>

    </template>

    <!-- Completely disable TOTP portal section -->
    <template id="disable_totp_portal" inherit_id="auth_totp_portal.totp_portal_hook" name="Disable TOTP Portal" active='true'>
        <xpath expr="//div[@id='totp_wizard_view']" position="replace">
            <!-- Remove TOTP wizard view -->
        </xpath>
        <xpath expr="//section[h4/a[@href='https://www.odoo.com/documentation/master/applications/general/auth/2fa.html']]" position="replace">
            <!-- Remove entire TOTP section by targeting the documentation link which doesn't change with localization -->
        </xpath>
    </template>

    <!-- Override payment methods page title and favicon -->
    <template id="custom_payment_methods_title" inherit_id="payment.payment_methods" name="Custom Payment Methods Title">
        <xpath expr="//t[@t-call='portal.frontend_layout']" position="inside">
            <t t-set="title">Zahlungsmethoden</t>
            <t t-set="x_icon">https://mediapool.hm.edu/media/_technik/img/_technik_1/favicon.jpg</t>
        </xpath>
    </template>
</odoo>
